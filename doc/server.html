<h1>Server configuration</h1>

<p>The default configuration file is <code>/etc/hbackup/config</code>,
which can be overriden with the <code>-c</code> option.</p>

<p>The following keywords are acceptable there:</p>
<table border="1" width="100%">
  <tr>
    <td><b>Keyword</b></td>
    <td><b>Description</b></td>
    <td width="25%"><b>Syntax</b></td>
    <td width="25%"><b>Example</b></td>
  </tr>
  <tr>
    <td>log</td>
    <td>log file path (default: no logging)</td>
    <td><code>log "&lt;log file path&gt;"</code></td>
    <td><code>db "/var/log/hbackup.log"</code></td>
  </tr>
  <tr>
    <td>db</td>
    <td>backup database path (default: "/hbackup")</td>
    <td><code>db "&lt;path to backup database&gt;"</code></td>
    <td><code>db "/backup"</code></td>
  </tr>
  <tr>
    <td>client</td>
    <td>client name and subset name (subset required for clients with
    multiple backups, typically with Linux / MacOS / Windows installs under
    the same client name).
    <br>Note: the subset must be matched in the client's configuration</td>
    <td><code>client "&lt;client desired name&gt;"
    ["&lt;client subset&gt;"]</code></td>
    <td><code>client "montblanc"</code>
      <br><code>client "montblanc" "kubuntu"</code></td>
  </tr>
  <tr>
    <td>filter</td>
    <td>filter definition</td>
    <td>See <a href="filters.html">Filters</a>.</td>
    <td>See <a href="filters.html">Filters</a>.</td>
  </tr>
  <tr>
    <td>compress_auto</td>
    <td>automatically select whether to store compressed file data</td>
    <td><code>compress_auto</code></td>
    <td><code>compress_auto</code></td>
  </tr>
  <tr>
    <td>timeout_nowarning</td>
    <td>do not emit a warning if a client connection times out</td>
    <td><code>timeout_nowarning</code></td>
    <td><code>timeout_nowarning</code></td>
  </tr>
  <tr>
    <td>report_copy_error_once</td>
    <td>do not emit an error if a file copy fails again</td>
    <td><code>report_copy_error_once</code></td>
    <td><code>report_copy_error_once</code></td>
  </tr>
</table>

<h2>Log section</h2>

<p>The <i>log</i> keyword can be followed by the keywords below:</p>

<table border="1" width="100%">
  <tr>
    <td><b>Keyword</b></td>
    <td><b>Description</b></td>
    <td width="25%"><b>Syntax</b></td>
    <td width="25%"><b>Example</b></td>
  </tr>
  <tr>
    <td>max_lines</td>
    <td>maximum number of lines in log file</td>
    <td><code>max_lines "&lt;n&gt;"</code></td>
    <td><code>max_lines "100000"</code></td>
  </tr>
  <tr>
    <td>backups</td>
    <td>maximum number of log file backups to keep</td>
    <td><code>backups "&lt;n&gt;"</code></td>
    <td><code>backups "10"</code></td>
  </tr>
</table>

<h2>Client section</h2>

<p>The <i>client</i> keyword starts a new client section, and can be followed
by the keywords below:</p>

<table border="1" width="100%">
  <tr>
    <td><b>Keyword</b></td>
    <td><b>Description</b></td>
    <td width="25%"><b>Syntax</b></td>
    <td width="25%"><b>Example</b></td>
  </tr>
  <tr>
    <td>protocol</td>
    <td>protocol to be used to connect to client (mandatory)</td>
    <td><code>protocol "&lt;protocol&gt;"</code></td>
    <td><code>protocol "file"</code>
      <br><code>protocol "nfs"</code>
      <br><code>protocol "smb"</code></td>
  </tr>
  <tr>
    <td>timeout_nowarning</td>
    <td>do not emit a warning if the connection times out</td>
    <td><code>timeout_nowarning</code></td>
    <td><code>timeout_nowarning</code></td>
  </tr>
  <tr>
    <td>report_copy_error_once</td>
    <td>do not emit an error if a file copy fails again</td>
    <td><code>timeout_nowarning</code></td>
    <td><code>timeout_nowarning</code></td>
  </tr>
  <tr>
    <td>config</td>
    <td>path to the client's configuration file, on the client</td>
    <td><code>config "&lt;path to file&gt;"</code></td>
    <td><code>config "C:/Backup/hbackup.list"</code>
      <br><code>config "/etc/hbackup.list"</code></td>
  </tr>
  <tr>
    <td>hostname</td>
    <td>network host name (default: client name)
      <br>network address (e.g. IP address)</td>
    <td><code>hostname "&lt;client host name&gt;"</code>
      <br><code>hostname "&lt;client IP address&gt;"</code></td>
    <td><code>hostname "everest.local"</code>
      <br><code>hostname "192.168.0.2"</code></td>
  </tr>
  <tr>
    <td>option</td>
    <td>file system option
      <br>file system option value</td>
    <td><code>option "&lt;option name&gt;"</code>
      <br><code>option "&lt;option name&gt;" "&lt;value&gt;"</code></td>
    <td><code>option "nolock"</code>
      <br><code>option iocharset "utf8"</code></td>
  </tr>
</table>

<p>The config option may be omitted and a <a href="client.html">client
configuration</a> inlined in its place (cf. example below).</p>

<p>Note for SMB protocol users: hbackup uses CIFS, and as such will not use the
SMB protocol to resolve client names into IP addresses. See below.</p>

<p>Note on client names: if you do not have a name server (DNS) in your network
(very likely if you are a home user), you will need to use the hostname keyword
to either specify an IP address (make sure it never changes!) or a
zero-configuration networking hostname (<code>hostname "&lt;client host
name&gt;.local"</code>), using the Zeroconf protocol.
Modern Linux distribution come with it pre-installed,
and you can install Apple Bonjour on your Windows machines.
MacOS X machines obviously have Bonjour as standard (since 10.2).</p>

<h2>Filter section</h2>

<p>The <i>filter</i> keyword starts a new filter section. Filter sections can
be anywhere. The filters defined here are available globally.</p>

<p>For information on the syntax, please refer to
<a href="filters.html">Filters</a>.</p>

<h2>Example</h2>

<p><code><pre>
# Define DB path
db /backup

# Some common filters

filter or compressed-archives
  condition name_end .ace
  condition name_end .bz2
  condition name_end .gz
  condition name_end .lzo
  condition name_end .rar
  condition name_end .zip
  condition name_end .Z

filter or compressed-images
  condition name_end .gif
  condition name_end .jpg
  condition name_end .png

filter or compressed
  condition filter compressed-archives
  condition filter compressed-images


filter or object-files
  condition name_end .o
  condition name_end .obj

filter or backup-files
  condition name_end ~
  condition name_end .bak
  condition name_end .dup


filter or firefox-profile
  condition path_end Firefox/Profiles

filter or opera-profile
  condition path_end "Application Data/Opera/Opera/profile"

filter or browser-profiles
  condition filter firefox-profile
  condition filter opera-profile


filter or windows-registry
  condition name NTUSER.DAT.LOG



# Client everest (local)
client everest
  protocol file
  config /etc/hbackup/list

# Client montblanc (Microsoft network)
client montblanc
  protocol smb
  option username Administrator
  option password "A6ug9^;k"
  config C:/backup/hbackup.list

# Client mckinley (Unix network)
client mckinley unix
  protocol nfs
  option nolock
  path /home
    filter any dotfiles
    condition name_start .
    ignore dotfiles

# Client mckinley (Microsoft network)
client mckinley win_xp
  protocol smb
  option username Administrator
  config C:\hbackup.cfg
</pre></code></p>
