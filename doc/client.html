<h1>Client configuration</h1>

<h2>Client setup</h2>

<h3>Network File System (NFS)</h3>

<p>It is warmly recommended for the client to export to the backup server only,
with the following options: read-only, no squash.</p>

<p>Example of <code>/etc/exports</code> entry, where fujiyama is the name of
the backup server:
<br><code>/home fujiyama(no_root_squash,no_all_squash,ro)</code></p>

<h3>Server Message Block (SMB)</h3>

<p>By default, Windows XP and Windows Vista will authenticate all users as
guests when accessed remotely. Windows 2000 is not affected.
<br>For hbackup to work properly, such computers need to be told to use the
classic authentication which authenticates users as themselves, so the
administrative shares can be mounted as Administrator.</p>

<p>Instructions:</p>
<ul>
  <li><i>Start</i> -> <i>Control Panel</i> -> <i>Administrative Tools</i> ->
    <i>Local Security Policy</i></li>
  <li>On the left hand side, expand <i>Local Policies</i> (click the <i>+</i>
    sign)</li>
  <li>Click <i>Security Options</i></li>
  <li>On the right hand side, find <i>Network access: Sharing and security
    model (...)</i></li>
  <li>Double click it, change to <i>Classic - local users authenticate as
    themselves</i></li>
  <li>Click <i>OK</i>, quit <i>Local Security Policy</i> then quit
    <i>Administrative Tools</i></li>
</ul>

<h2>Configuration file</h2>

<h3>Client section</h3>

<p>This is the section preceding any path section. Client-wide definitions
include <a href="filters.html">filters</a> and expiration delay.</p>

<table border="1" width="100%">
  <tr>
    <td><b>Keyword</b></td>
    <td><b>Description</b></td>
    <td width="25%"><b>Syntax</b></td>
    <td width="25%"><b>Example</b></td>
  </tr>
  <tr>
    <td>subset</td>
    <td>subset name matching that in the server configuration</td>
    <td><code>subset "&lt;name&gt;"</code></td>
    <td><code>subset "xp"</code></td>
  </tr>
  <tr>
    <td>expire</td>
    <td>expiration delay (days) for removed items to be deleted</td>
    <td><code>expire "&lt;delay&gt;"</code></td>
    <td><code>expire "180"</code></td>
  </tr>
  <tr>
    <td>users</td>
    <td>users that exist on the server that can restore files from this
      client/subset</td>
    <td><code>users user#1 [user#2 [... [user#n]]]</code></td>
    <td><code>users herve pierre heloise</code></td>
  </tr>
  <tr>
    <td>report_copy_error_once</td>
    <td>do not emit an error if a file copy fails again</td>
    <td><code>timeout_nowarning</code></td>
    <td><code>timeout_nowarning</code></td>
  </tr>
</table>

<h3>Path section</h3>

<p>This section starts with a <code>path</code> defintion and signals the end
of the client section. Path-wide definitions include
<a href="filters.html">filters</a> and the following keywords:</p>

<table border="1" width="100%">
  <tr>
    <td><b>Keyword</b></td>
    <td><b>Description</b></td>
    <td width="25%"><b>Syntax</b></td>
    <td width="25%"><b>Example</b></td>
  </tr>
  <tr>
    <td>path</td>
    <td>path to backup, starts a new path section</td>
    <td><code>path "&lt;path to backup&gt;"</code>
      <br>Note: must not end with a '\'</td>
    <td><code>path "/home"</code>
      <br><code>path "C:\Documents and Settings"</code></td>
  </tr>
  <tr>
    <td>parser</td>
    <td>version control parser to use, see
      <a href="parsers.html">Parsers</a></td>
    <td><code>parser "&lt;parser name&gt;" "&lt;mode&gt;"</code></td>
    <td><code>parser "cvs" "modified"</code></td>
  </tr>
  <tr>
    <td>ignore</td>
    <td>filter to use to determine which files to ignore, see
      <a href="filters.html">Filters</a></td>
    <td><code>ignore "&lt;filter name&gt;"</code></td>
    <td><code>ignore "ignore_filter"</code></td>
  </tr>
  <tr>
    <td>compress</td>
    <td>filter to use to determine which files to compress, see
      <a href="filters.html">Filters</a></td>
    <td><code>compress "&lt;filter name&gt;"</code></td>
    <td><code>compress "ignore_filter"</code></td>
  </tr>
  <tr>
    <td>report_copy_error_once</td>
    <td>do not emit an error if a file copy fails again</td>
    <td><code>timeout_nowarning</code></td>
    <td><code>timeout_nowarning</code></td>
  </tr>
</table>

<p>Note: files that match the compress filter are compressed using the gzip
format, with level 5, the best size over speed ratio in my tests. If a file is
already stored in the backup database, whether compressed or not, it does not
get re-added in the other form.</p>

<h3>Filter section</h3>

<p>Filter sections can either be before any path section, in which case the
filters are available to any path, or within a path section, in which case
they are only available to that path.</p>

<p>For information on the syntax, please refer to
<a href="filters.html">Filters</a>.</p>

<h3>Example of complex client configuration file</h3>

<p><code><pre>
# Has this subset required by server configuration
subset xp

# Files removed 6 months ago can be deleted from DB
expire 180

# Define compressed archives
filter any compressed_archives
condition name_end .bz2
condition name_end .gz
condition name_end .zip

# Define compressed images
filter any compressed_images
condition name_end .jpg
condition name_end .png
condition name_end .gif

# Define compressed files based on two previous filters
filter any compressed_files
condition filter compressed_archives
condition filter compressed_images

# Define files worth compressing based on previous filter and size condition
filter all worth_compressing
condition !filter compressed_files
condition size>= 1024

# Path to backup: /etc
path /etc
# Specific filter
filter any ignored_files
condition path .mtab
# Files to be ignored selection filter
ignore ignored_files
# Files to be compressed selection filter
compress worth_compressing

# Path to backup: /home
path /home
# Use CVS parser to get modified files
parser cvs modified
# Specific filter
filter any not_worth_backing_up
condition path .kde
condition path .mozilla
condition path .xsession-errors
condition path .viminfo
condition path .bash_history
# Files to be ignored selection filter
ignore not_worth_backing_up
# Files to be compressed selection filter
compress worth_compressing
</pre></code></p>
