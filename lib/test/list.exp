Test: DB lists

Test: journal write

Test: journal read
[ 1] prefix           file_gone                          [rm]
[ 1] prefix2          file sp                            f     0 644 
[ 1] prefix2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] prefix3          link                               l     8 777 testfile
[ 1] prefix5          path                               d     0 755

Test: journal merge into empty list
List is empty

Test: merge read
[ 1] prefix           file_gone                          [rm]
[ 1] prefix2          file sp                            f     0 644 
[ 1] prefix2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] prefix3          link                               l     8 777 testfile
[ 1] prefix5          path                               d     0 755

Test: journal write again

Test: journal read
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 0] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 5] prefix4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e

Test: journal merge into list

Test: merge read
[ 1] prefix           file_gone                          [rm]
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 0] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] prefix2          file sp                            f     0 644 
[ 5] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] prefix3          link                               l     8 777 testfile
[ 5] prefix4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] prefix5          path                               d     0 755

Test: get all prefixes
prefix
prefix2
prefix3
prefix4
prefix5

Test: journal prefix out of order

Test: journal read
[ 9] prefix4          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 9] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: journal merge into list
Prefix out of order in journal, line 4
Failed to merge: Structure needs cleaning

Test: merge read
[ 1] prefix           file_gone                          [rm]
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] prefix3          link                               l     8 777 testfile
[ 9] prefix4          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: journal path out of order

Test: journal read
[13] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[13] prefix2          file_gone                          f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: journal merge into list
Path out of order in journal, line 5
Failed to merge: Structure needs cleaning

Test: merge read
[ 1] prefix           file_gone                          [rm]
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[13] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: prefix find
prefix 'path' not found
[ 1] prefix           file_gone                          [rm]
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[13] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
prefix 'silly' not found
prefix 'prefix2' found
[ 1] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[13] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: expire
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 5] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 5] prefix4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
Active checksums (gross): 3
 12fec763b7f0a7d6acfc8bfe7606c325
 12fec763b7f0a7d6acfc8bfe7606c325
 d41d8cd98f00b204e9800998ecf8427e
Active checksums (sorted, uniqued): 2
 12fec763b7f0a7d6acfc8bfe7606c325
 d41d8cd98f00b204e9800998ecf8427e
Expired checksums (gross): 2
 d41d8cd98f00b204e9800998ecf8427e
 59ca0efa9f5633cb0371bbc0355478d8
Expired checksums (sorted, uniqued): 2
 59ca0efa9f5633cb0371bbc0355478d8
 d41d8cd98f00b204e9800998ecf8427e
Expired checksums: 1
 59ca0efa9f5633cb0371bbc0355478d8

Test: copy prefix data
List:
[ 1] prefix           file_gone                          [rm]
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 0] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] prefix2          file sp                            f     0 644 
[ 5] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] prefix3          link                               l     8 777 testfile
[ 5] prefix4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] prefix5          path                               d     0 755
Merge:
[ 1] prefix           file_gone                          [rm]
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
Merge tail:
# end

Test: get latest entry only
List:
[ 1] prefix           file_gone                          [rm]
[17] prefix           file_new                           f    22 644 246dccb0301976d765609dfb0efd68f9
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8

Test: last entries data
List:
[ 1] prefix           file_gone                          [rm]
[17] prefix           file_new                           f    22 644 246dccb0301976d765609dfb0efd68f9
[ 1] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: entries for given date
List:
[ 1] prefix           file_gone                          [rm]
[ 5] prefix           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] prefix2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] prefix2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
