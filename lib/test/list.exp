Test: DB lists

Test: journal write

Test: journal read
[ 1] client           file_gone                          [rm]
[ 1] client2          file sp                            f     0 644 
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] client3          link                               l     8 777 testfile
[ 1] client5          path                               d     0 755

Test: journal merge into empty list
List is empty

Test: merge read
[ 1] client           file_gone                          [rm]
[ 1] client2          file sp                            f     0 644 
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] client3          link                               l     8 777 testfile
[ 1] client5          path                               d     0 755

Test: journal write again

Test: journal read
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 0] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 5] client4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e

Test: journal merge into list

Test: merge read
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] client3          link                               l     8 777 testfile
[ 5] client4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] client5          path                               d     0 755

Test: client find
client 'abcd' not found
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] client3          link                               l     8 777 testfile
[ 5] client4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] client5          path                               d     0 755
client 'silly' not found
client 'client2' found
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] client3          link                               l     8 777 testfile
[ 5] client4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] client5          path                               d     0 755

Test: get all clients
client
client2
client3
client4
client5

Test: get all paths for client
file_gone
file_gone: -
file_new
file_new: f

file_new: P


path: d

Test: journal client out of order

Test: journal read
[10] client4          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[10] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: journal merge into list
Client out of order in journal, line 4
Failed to merge: Structure needs cleaning

Test: merge read
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] client3          link                               l     8 777 testfile
[10] client4          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: journal path out of order

Test: journal read
[14] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[14] client2          file_gone                          f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: journal merge into list
Path out of order in journal, line 4
Failed to merge: Structure needs cleaning

Test: merge read
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[14] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: expire
List:
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] client3          link                               l     8 777 testfile
[ 5] client4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] client5          path                               d     0 755
Date: 4
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client3          link                               l     8 777 testfile
[ 5] client4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] client5          path                               d     0 755
Active checksums (gross): 4
 12fec763b7f0a7d6acfc8bfe7606c325
 d41d8cd98f00b204e9800998ecf8427e
 12fec763b7f0a7d6acfc8bfe7606c325
 d41d8cd98f00b204e9800998ecf8427e
Active checksums (sorted, uniqued): 2
 12fec763b7f0a7d6acfc8bfe7606c325
 d41d8cd98f00b204e9800998ecf8427e
Expired checksums (gross): 1
 59ca0efa9f5633cb0371bbc0355478d8
Expired checksums (sorted, uniqued): 1
 59ca0efa9f5633cb0371bbc0355478d8
Expired checksums: 1
 59ca0efa9f5633cb0371bbc0355478d8
Date: 0
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client3          link                               l     8 777 testfile
[ 5] client4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] client5          path                               d     0 755
Active checksums (gross): 6
 12fec763b7f0a7d6acfc8bfe7606c325
 d41d8cd98f00b204e9800998ecf8427e
 12fec763b7f0a7d6acfc8bfe7606c325
 d41d8cd98f00b204e9800998ecf8427e
 12fec763b7f0a7d6acfc8bfe7606c325
 d41d8cd98f00b204e9800998ecf8427e
Active checksums (sorted, uniqued): 2
 12fec763b7f0a7d6acfc8bfe7606c325
 d41d8cd98f00b204e9800998ecf8427e
Expired checksums (gross): 2
 59ca0efa9f5633cb0371bbc0355478d8
 59ca0efa9f5633cb0371bbc0355478d8
Expired checksums (sorted, uniqued): 1
 59ca0efa9f5633cb0371bbc0355478d8
Expired checksums: 1
 59ca0efa9f5633cb0371bbc0355478d8

Test: copy client data
List:
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
[ 1] client3          link                               l     8 777 testfile
[ 5] client4          file_new                           f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 1] client5          path                               d     0 755
Merge:
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8
Merge tail:
# end

Test: get latest entry only
List:
[ 1] client           file_gone                          [rm]
[17] client           file_new                           f    22 644 246dccb0301976d765609dfb0efd68f9
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file_new                           f    13 644 59ca0efa9f5633cb0371bbc0355478d8

Test: last entries data
List:
[ 1] client           file_gone                          [rm]
[17] client           file_new                           f    22 644 246dccb0301976d765609dfb0efd68f9
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325

Test: entries for given date
List:
[ 1] client           file_gone                          [rm]
[ 5] client           file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
[ 1] client2          file sp                            f     0 644 d41d8cd98f00b204e9800998ecf8427e
[ 5] client2          file_new                           f    20 644 12fec763b7f0a7d6acfc8bfe7606c325
