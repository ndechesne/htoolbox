#!/bin/sh

hbackup="../../hbackup"

echo "Version"
"$hbackup" --version -- 2>&1

echo "Help"
"$hbackup" -h -- 2>&1

echo "Error"
"$hbackup" -! -- 2>&1

echo "List clients (missing DB path)"
"$hbackup" -d -c etc/hbackup.conf -l 2>&1

echo "List clients (empty DB path)"
mkdir test_db
"$hbackup" -d -c etc/hbackup.conf -l 2>&1
rmdir test_db

echo "Backup, DB missing"
"$hbackup" -d -c etc/hbackup.conf -- 2>&1

echo "Typical backup, initialize DB"
"$hbackup" -di -c etc/hbackup.conf -- 2>&1

echo "Specify clients"
"$hbackup" -d -c etc/hbackup.conf -C myhost -C client.xp 2>&1

export HOME="$TESTDIRUSER"
echo "User-mode backup"
"$hbackup" -diu -- 2>&1

echo "User-mode backup: upper verbosity level"
rm -r "$TESTDIRUSER/.hbackup/localhost"
"$hbackup" -uv -- 2>&1

echo "User-mode backup: standard verbosity level"
rm -r "$TESTDIRUSER/.hbackup/localhost"
"$hbackup" -u -- 2>&1

echo "User-mode backup: quiet"
rm -r "$TESTDIRUSER/.hbackup/localhost"
"$hbackup" -uq -- 2>&1

echo "Fix DB"
"$hbackup" -d -c etc/hbackup.conf -f 2>&1

echo "Scan DB"
"$hbackup" -d -c etc/hbackup.conf -s 2>&1

echo "Check DB"
"$hbackup" -d -c etc/hbackup.conf -t 2>&1

echo "List clients"
"$hbackup" -d -c etc/hbackup.conf -l 2>&1

echo "List paths in myhost"
"$hbackup" -d -c etc/hbackup.conf -l -C myhost 2>&1

echo "List paths in myhost under test2/"
"$hbackup" -d -c etc/hbackup.conf -l -C myhost -P test2/ 2>&1

echo "List paths in myhost under test1/cvs"
"$hbackup" -d -c etc/hbackup.conf -l -C myhost -P test1/cvs 2>&1

echo "List paths in both myhost and aClient.vista"
"$hbackup" -d -c etc/hbackup.conf -l -C myhost -C aClient.vista 2>&1

echo "List paths in dual-boot client myClient"
"$hbackup" -d -c etc/hbackup.conf -l -C "myClient*" 2>&1

echo "List paths in all clients"
"$hbackup" -d -c etc/hbackup.conf -l -C "*" 2>&1

echo "Restore a file"
rm -rf test_r && "$hbackup" -d -c etc/hbackup.conf -r test_r -C myhost -P test2/testfile 2>&1

echo "Restore all data in a client/dir path that's not by itself in DB"
rm -rf test_r && "$hbackup" -d -c etc/hbackup.conf -r test_r -C myhost -P test1 -D 0 2>&1

echo "Restore all data in a client/dir path"
rm -rf test_r && "$hbackup" -d -c etc/hbackup.conf -r test_r -C myhost -P test1/cvs 2>&1

echo "Restore all data in a client"
rm -rf test_r && "$hbackup" -d -c etc/hbackup.conf -r test_r -C myhost 2>&1

echo "Broken configuration"
"$hbackup" -d -c etc/broken.conf -- 2>&1

exit 0