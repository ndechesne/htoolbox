#!/bin/sh

prog="../../hwbackup"

echo "Testing: $prog"

echo
echo "Help"
$prog -h -- 2>&1

echo
echo "Wrong config"
$prog -c /test1/doesnotexist || echo -n ""

echo
echo "Wrong config"
$prog -c test1/testfile

echo
echo "Nothing yet"
$prog -c etc/hbackup.conf -v -w test_web

# Backup
../../hbackup -c etc/hbackup.conf -iq -C aClient.vista > /dev/null 2>&1
touch -c -d "20080727 23:59 GMT" test_db/aClient.vista/.last-backup

echo
echo "Wrong website"
$prog -c etc/hbackup.conf -v -w /proc/0

echo
echo "Backup for one client"
$prog -c etc/hbackup.conf -v -w test_web
echo "Index:"
cat test_web/index.xhtml

# Scan
../../hbackup -c etc/hbackup.conf -s > /dev/null 2>&1
touch -c -d "20080728 GMT" test_db/.last-scan

echo
echo "Scanned"
$prog -c etc/hbackup.conf -v -w test_web
echo "Index:"
cat test_web/index.xhtml

# Check
../../hbackup -c etc/hbackup.conf -t > /dev/null 2>&1
touch -c -d "20080728 00:01 GMT" test_db/.last-check

echo
echo "Checked"
$prog -c etc/hbackup.conf -v -w test_web
echo "Index:"
cat test_web/index.xhtml
